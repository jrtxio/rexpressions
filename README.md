# RExpressions 正则表达式工具

## 功能概述

RExpressions 是一个以**用户控制、隐私优先、本地优先**为核心的正则表达式辅助工具。它通过"上下文"模型组织工作流，集成受控 AI 辅助，并为未来协作与生态扩展预留架构。

## 核心概念

|术语|定义|
|---|---|
|**上下文（Context）**|一个独立工作单元，包含：唯一 ID（UUID）、名称、正则表达式、测试文本、创建/更新时间戳|
|**AI 命名**|当上下文无用户指定名称时，系统调用 AI 基于正则+测试文本生成 ≤8 字中文标题|
|**受控 AI 交互**|AI 默认无法访问用户数据；仅当用户使用 `@input` 或 `@current-regex` 时才提供上下文|
|**本地优先存储**|所有数据首先持久化到本地文件；云功能为可选插件|

## 功能特性

### V1 版本

#### 上下文管理
- ✅ 创建新空白上下文
- ✅ 删除当前选中上下文
- ✅ 自动生成 UUID v4
- ✅ 本地持久化存储
- ✅ 自动加载和保存

#### 正则测试
- ✅ 实时正则表达式语法校验
- ✅ 多行测试文本编辑
- ✅ 匹配结果黄色背景高亮
- ✅ 全局匹配模式
- ✅ 区分大小写

#### AI 对话
- ✅ 支持 `@input` 提供测试文本
- ✅ 支持 `@current-regex` 获取当前正则
- ✅ AI 生成 `@regex{...}` 格式正则
- ✅ 自动提取并应用 AI 生成的正则

## 界面布局

```
+------------------+--------------------------+------------------+
|   上下文列表     |      正则测试区          |    AI 对话窗口   |
| (左侧)           |      (中间)              |    (右侧)        |
|                  |                          |                  |
| • 提取邮箱       | [正则表达式输入框]       | [对话消息流]     |
| • 日期匹配       |                          |                  |
| • （未命名）     | [测试文本输入区]         | [用户输入框]     |
|                  | （匹配结果高亮显示）     |                  |
| [ + ]   [ − ]    |                          |                  |
| （左下角按钮）   |                          |                  |
+------------------+--------------------------+------------------+
```

## 技术实现

### 项目结构

```
regexpressions/
├── main.rkt              # 主程序入口
├── core/
│   ├── context.rkt       # 上下文数据结构与管理
│   ├── regex-engine.rkt  # 正则表达式处理引擎
│   └── storage.rkt       # 本地存储管理
├── gui/
│   └── main-window.rkt   # 主窗口布局
└── utils/
    ├── uuid.rkt          # UUID 生成
    └── ai-protocol.rkt   # AI 通信协议
```

### 核心数据结构

```racket
(struct regex-context (
  id          ; UUID v4
  name        ; 名称，≤8 字中文
  regex       ; 正则表达式
  test-text   ; 测试文本
  created-at  ; 创建时间戳
  updated-at  ; 更新时间戳
  metadata    ; 元数据（哈希表）
) #:prefab)    ; 支持序列化
```

### 本地存储

- **Windows**: `%APPDATA%\RExpressions\contexts.rktd`
- **macOS**: `~/Library/Application Support/RExpressions/contexts.rktd`
- **Linux**: `~/.local/share/RExpressions/contexts.rktd`

## 运行方式

```bash
racket main.rkt
```

## 用户典型流程

1. 启动 RExpressions → 自动创建空白上下文
2. 在 AI 窗口输入："提取 URL，@input"（测试文本已粘贴）
3. AI 返回 `@regex{https?://\S+}` → 自动填入 → 高亮匹配
4. 点击【+】新建任务
5. 切换回前一上下文 → 触发 AI 命名为 "URL 提取"
6. 关闭应用 → 所有上下文保存至本地
7. 重启后完整恢复

## 未来规划

### V2+ 版本
- ✅ 分享快照功能
- ✅ Web 查看器
- ✅ 团队协作
- ✅ 正则模板市场

## 技术特点

1. **本地优先**：所有数据首先持久化到本地文件
2. **隐私保护**：AI 默认无法访问用户数据，仅响应显式命令
3. **跨平台**：基于 Racket GUI，支持所有 Racket 支持的桌面操作系统
4. **易于扩展**：模块化设计，支持未来功能扩展
5. **用户友好**：直观的三栏布局，实时反馈

## 开发说明

### 依赖
- Racket 8.0+
- racket/gui 库

### 开发环境
- DrRacket（推荐）
- 或命令行 racket 解释器

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！